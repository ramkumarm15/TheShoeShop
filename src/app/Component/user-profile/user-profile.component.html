<main class="page-wrapper">
  <section class="container-fluid">
    <div class="row min-vh-100 mt-3">
      <aside class="col-lg-2 col-md-4 border-end pb-md-5 mb-md-5">
        <app-profile-sidenav></app-profile-sidenav>
      </aside>
      <div class="col-md-8 offset-lg-1 pt-5">
        <h2 class="pt-2">Account Details</h2>
        <!-- Basic info -->
        <h5 class="text-primary mb-4">Basic info</h5>
        <form
          class="needs-validation border-bottom pb-3"
          novalidate=""
          [formGroup]="userProfileForm"
          (ngSubmit)="onSubmit()"
        >
          <div class="row pb-2">
            <div class="col-sm-6 mb-4">
              <label for="email" class="form-label fs-base"
                >Email address</label
              >
              <input
                type="email"
                class="form-control form-control-lg"
                name="emailAddress"
                id="emailAddress"
                formControlName="emailAddress"
                required
                readonly
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['emailAddress'].invalid &&
                    userProfileForm.controls['emailAddress'].touched,
                  '': userProfileForm.controls['emailAddress'].valid
                }"
                [disabled]="true"
              />
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['emailAddress'].touched || userProfileForm.controls['emailAddress'].touched || userProfileForm.invalid) && userProfileForm.controls['emailAddress'].errors?.['required']"
              >
                This field is required
              </div>
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['emailAddress'].touched || userProfileForm.invalid) && userProfileForm.controls['emailAddress'].errors?.['email']"
              >
                Please provide a valid email address!
              </div>
            </div>
            <div class="col-sm-6 mb-4">
              <label for="name" class="form-label fs-base">Name</label>
              <input
                type="text"
                class="form-control form-control-lg"
                name="name"
                id="name"
                formControlName="name"
                required
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['name'].invalid &&
                    (userProfileForm.controls['name'].dirty ||
                      userProfileForm.controls['name'].touched),
                  '': userProfileForm.controls['name'].valid
                }"
              />
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['name'].touched || userProfileForm.invalid)
              && userProfileForm.controls['name'].errors?.['required']"
              >
                This field is required
              </div>
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['name'].touched || userProfileForm.invalid) && userProfileForm.controls['name'].errors?.['minlength']"
              >
                Minimum length is 8 characters
              </div>
            </div>
            <div class="col-sm-6 mb-4">
              <label for="city" class="form-label">City</label>
              <input
                type="text"
                id="city"
                class="form-control form-control-lg"
                formControlName="city"
                required
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['city'].invalid &&
                    userProfileForm.controls['city'].touched,
                  '': userProfileForm.controls['city'].valid
                }"
              />
              <div
                class="invalid-feedback"
                *ngIf="( userProfileForm.controls['city'].touched || userProfileForm.invalid) && userProfileForm.controls['city'].errors?.['required']"
              >
                city is required
              </div>
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['city'].dirty || userProfileForm.invalid) && userProfileForm.controls['city'].errors?.['minlength']"
              >
                Minimum length is 8 characters
              </div>
            </div>
            <div class="col-sm-6 mb-4">
              <label for="age" class="form-label">Age</label>
              <input
                type="number"
                id="age"
                class="form-control form-control-lg"
                formControlName="age"
                required
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['age'].invalid &&
                    userProfileForm.controls['age'].touched,
                  '': userProfileForm.controls['age'].valid
                }"
              />
              <div
                class="invalid-feedback"
                *ngIf="( userProfileForm.controls['age'].touched || userProfileForm.invalid) && userProfileForm.controls['age'].errors?.['required']"
              >
                age is required
              </div>
            </div>
            <div class="col-sm-6 mb-4">
              <label for="mobileNumber" class="form-label">Mobile Number</label>
              <input
                type="number"
                id="mobileNumber"
                class="form-control form-control-lg"
                formControlName="mobileNumber"
                (input)="mobileNumberLengthCheck($event)"
                required
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['mobileNumber'].invalid &&
                    userProfileForm.controls['mobileNumber'].touched,
                  '': userProfileForm.controls['mobileNumber'].valid
                }"
              />
              <div
                class="invalid-feedback"
                *ngIf="( userProfileForm.controls['mobileNumber'].touched || userProfileForm.invalid) && userProfileForm.controls['mobileNumber'].errors?.['required']"
              >
                Mobile Number is required
              </div>
              <div
                class="invalid-feedback"
                *ngIf="( userProfileForm.controls['mobileNumber'].touched || userProfileForm.invalid) && userProfileForm.controls['mobileNumber'].errors?.['requiredLength']"
              >
                Mobile number must be 10 digit
              </div>
            </div>
            <div class="col-sm-6 mb-4">
              <label for="gender" class="form-label">Gender</label>
              <select
                class="form-select form-select-lg"
                id="gender"
                formControlName="gender"
                required
              >
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="NotPreferToSay">NotPreferToSay</option>
              </select>
              <div
                class="invalid-feedback"
                *ngIf="( userProfileForm.controls['gender'].touched || userProfileForm.invalid) && userProfileForm.controls['gender'].errors?.['required']"
              >
                mobileNumber is required
              </div>
            </div>
            <div class="col-12 mb-4">
              <label for="bio" class="form-label">About</label>
              <textarea
                id="bio"
                class="form-control form-control-lg"
                rows="4"
                placeholder="Add a short bio..."
                formControlName="about"
                required
                [ngClass]="{
                  'is-invalid':
                    userProfileForm.controls['about'].invalid &&
                    userProfileForm.controls['about'].touched,
                  '': userProfileForm.controls['about'].valid
                }"
              ></textarea>
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['about'].touched || userProfileForm.invalid) && userProfileForm.controls['about'].errors?.['required']"
              >
                This field is required!
              </div>
              <div
                class="invalid-feedback"
                *ngIf="(userProfileForm.controls['about'].dirty || userProfileForm.invalid) && userProfileForm.controls['about'].errors?.['maxlength']"
              >
                Maximum length is 200 characters
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mb-3">
            <ng-container *ngIf="!loading; else elseButton">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="userProfileForm.invalid"
              >
                Save changes
              </button>
            </ng-container>
            <ng-template #elseButton>
              <button type="button" class="btn btn-primary pe-none">
                <span
                  class="spinner-grow spinner-grow-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                <span>Saving...</span>
              </button>
            </ng-template>
          </div>
        </form>
        <h2 class="mt-3 pt-2">Address</h2>
        <div class="row mt-0" *ngIf="userDetails">
          <div
            class="col-md-6 address mb-3"
            *ngFor="let address of userDetails.billingAddresses"
          >
            <div class="card mt-3">
              <div class="card-body">
                <h5>
                  {{ address.billingName | titlecase }}
                  <span
                    class="badge bg-faded-success text-success default-badge float-end"
                    *ngIf="address.default"
                    >Default</span
                  >
                </h5>
                <div class="addressData">
                  <h5 class="text-truncate">
                    <span>Address:</span>
                    {{ address.address1 }}, {{ address.address2 }},
                    {{ address.city }}, {{ address.state }}-{{
                      address.postalCode
                    }}
                  </h5>
                </div>
                <div class="addressData">
                  <h5>
                    <span>Phone number:</span>
                    {{ address.mobileNumber }}
                  </h5>
                </div>
                <div class="addressAction">
                  <a
                    type="button"
                    class="btn btn-outline-secondary me-2"
                    [routerLink]="['/profile/address']"
                  >
                    Edit
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
